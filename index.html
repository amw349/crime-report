<html>
<head>
    <title>Crime in New York City</title>
    <link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/styles/default.min.css">
    <script type="text/javascript" src="js/geojson.min.js"></script>
    <script src="https://d3js.org/d3.v4.min.js"></script>
    <script src="http://d3js.org/topojson.v2.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/highlight.min.js"></script>

    <style>
        /* Because this project was labelled as a "display as if it were
           a poster" sort of endeavor, we decided to go for a fixed page width
           to make sure the experience would be standardized and not subject to
           individual screen sizes (much like actual posters). */
        body{ font-family: "Roboto",sans-serif;
            margin: 0;
            background-color: #222222;
            width: 1600px;
            display: inline-block;}
        svg { margin: 0 0 0 0;
            float:left; }
        svg#border
            { background: url(images/banner.jpg);
            display: block;
            width: 1600px;
            height: 120px; }
        svg#borough_map
            {}
        svg#borough_plot
            {}
        path.borough_map
            { stroke: 4px; }
        .axisB line
            { stroke: #ffffff; }
        .axisB path
            { stroke: #ffffff; }
        .axisB text
            { fill: #ffffff; }
    </style>
</head>
<body>
     <svg id="border" viewBox="0 0 100 10" preserveAspectRatio="none">
        <text
        font-weight = "900"
        fill= "#ffffff" text-anchor="middle" x="55" y="7" font-size="4.5px">NYPD Complaint Data Analysis</text>
        <image x="10" y="1.7" width="7" height="7" xlink:href="images/badge.png">
    </svg>

    <svg id ="info_blurb" width="800" height="450"></svg>
    <svg id ="borough_plot" width="800" height="450"></svg>
    <svg id ="borough_map1" width="800" height="700"></svg>

    <script>

    var geo;
    var tsv;

    var svg0 = d3.select("#borough_plot");
    var svg1 = d3.select("#borough_map1");

    var projection = d3.geoMercator();

    d3.tsv("data/smaller.tsv", function(error, data) {
        tsv = data;
    });

    //Geojson data taken from https://github.com/dwillis/nyc-maps
    d3.json("data/boroughs.geojson", function (error, data) {
        geo = data;
        showConcentration();
        showMap(1);
        plotPoints1();

    });



    function showMap(num) {

        var map_id = "#borough_map"+num;
        var svg1 = d3.select(map_id);

        projection.fitExtent([[100,100], [600, 600]], geo);
        pathGenerator = d3.geoPath().projection(projection);
        var paths = svg1.selectAll("path.borough_map").data(geo.features);

        paths.enter()
        .append("path")
        .attr("class", "borough_map")
        .attr("stroke","#bbbbbb")
        .attr("stroke-width",1)
        .attr("opacity",1)
        .attr("fill", function () { return "#222233"; })
        .merge(paths)
        .attr("d", function (borough_map) { return pathGenerator(borough_map); });
    }

    function plotPoints1() {

        //scale domains and ranges calculated by searching through the geojson file.
        var scaleLati = d3.scaleLinear().domain([40.91553,40.496115]).range([100,600]);
        var scaleLongi = d3.scaleLinear().domain([-74.25559,-73.70000]).range([100,600]);

        //Pins
        svg1.append("text").html("Manhattan").attr("font-size",17).attr("x",260).attr("y",220).attr("fill", "#aaaaaa"); //Manhattan
        svg1.append("text").html("Bronx").attr("font-size",17).attr("x",470).attr("y",100).attr("fill", "#aaaaaa"); //Bronx
        svg1.append("text").html("Brooklyn").attr("font-size",17).attr("x",290).attr("y",550).attr("fill", "#aaaaaa"); //Brooklyn
        svg1.append("text").html("Queens").attr("font-size",17).attr("x",570).attr("y",250).attr("fill", "#aaaaaa"); //Queens
        svg1.append("text").html("Staten Island").attr("font-size",17).attr("x",140).attr("y",400).attr("fill", "#aaaaaa"); //Staten Island

        //Title
        svg1.append("text").html("NYPD Complaint Map Projection")
        .attr("transform", "translate(400, 50)").attr("text-anchor","middle").attr("font-size","25").attr("fill", "#ffffff");

        //Data
        tsv.forEach( function(d) {
            if ((d.Latitude != undefined) && (d.Longitude != undefined)){
                var lati = parseFloat(d.Latitude);
                var longi = parseFloat(d.Longitude);
                svg1.append("circle")
                .attr("cx", scaleLongi(longi))
                .attr("cy", scaleLati(lati))
                .attr("r", 2)
                .style("fill", function() {
                    if (d.LAW_CAT_CD == "VIOLATION") {return "#ffff00";}
                    else if (d.LAW_CAT_CD == "MISDEMEANOR") {return "#FFA500";}
                    else if (d.LAW_CAT_CD == "FELONY") {return "#ff0000";}
                });
            }
        });
    }

    function showConcentration() {

        //Axis
        var scaleB = d3.scaleLinear().domain([0,24]).range([0,600]);
        var axB = d3.axisBottom(scaleB).tickFormat(function(d) {
            var ampm; var hour;
            if (d==24 || d-12<0) ampm = "AM"; else ampm = "PM";
            if (d%12 == 0) hour = 12; else hour = d%12;
            return hour+ampm;
        });
        svg0.append("g").attr("transform", "translate(150, 400)").attr("class", "axisB").call(axB);

        //Text
        svg0.append("text").html("Bronx").attr("transform", "translate(125, 355)").attr("text-anchor","end").attr("fill", "#aaaaaa");
        svg0.append("text").html("Brooklyn").attr("transform", "translate(125, 295)").attr("text-anchor","end").attr("fill", "#aaaaaa");
        svg0.append("text").html("Manhattan").attr("transform", "translate(125, 235)").attr("text-anchor","end").attr("fill", "#aaaaaa");
        svg0.append("text").html("Queens").attr("transform", "translate(125, 175)").attr("text-anchor","end").attr("fill", "#aaaaaa");
        svg0.append("text").html("Staten Island").attr("transform", "translate(125, 115)").attr("text-anchor","end").attr("fill", "#aaaaaa");
        svg0.append("text").html("Concentration of Reports by Time of Day (per Borough)")
        .attr("transform", "translate(400, 50)").attr("text-anchor","middle").attr("font-size","25").attr("fill", "#ffffff").attr("font-weight","900");

        //Data
        tsv.forEach( function(d) {
            var dtime = d.CMPLNT_FR_TM
            if (dtime != undefined){
                var hour = dtime.split(":")[0];
                var minute = dtime.split(":")[1];
                var inthour = parseFloat(hour);
                var intminute = parseFloat(minute);

                svg0.append("rect")
                .attr("x", inthour*25+intminute*25/60+150)
                .attr("y", function () {
                    var name = d.BORO_NM;
                    if (name == "STATEN ISLAND") return 100;
                    else if (name == "QUEENS") return 160;
                    else if (name == "MANHATTAN") return 220;
                    else if (name == "BROOKLYN") return 280;
                    else return 340; //Bronx
                })
                .attr("height",20)
                .attr("width",6)
                .attr("opacity",0.15)
                .attr("fill", "#ff0000")
            }
        });
    }
    </script>

</body>
</html>
